{"version":3,"sources":["serial/parser.js"],"names":["stream","require","parseDashStatus","out","data","state","parsePackStatus","carName","SOC","flag","push","parseVoltageData","min_voltage","max_voltage","pack_voltage","parseTemperature","temp_array","i","length","highest","pack_max_temp","parseThrottle","difference_check","throttle","parseBrake","brake","chooseParser","parseStream","options","objectMode","chunk","encoding","next","transformed","parse","Object","array","CAN_Id","Timestamp","Transform","module","exports"],"mappings":"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","file":"parser.js","sourcesContent":["var stream = require('stream');\r\nfunction parseDashStatus(out,data){\r\n    out.state = data[2];\r\n}\r\nfunction parsePackStatus(out,data){\r\n    out.carName = data[2];\r\n    out.SOC = data[3];\r\n    var flag = data[4] << 8 | data[5];\r\n    out.flag = [];\r\n    out.flag.push((flag&0x0000)==0x0000);\r\n    out.flag.push((flag&0x0001)==0x0001);\r\n    out.flag.push((flag&0x0002)==0x0002);\r\n    out.flag.push((flag&0x0004)==0x0004);\r\n    out.flag.push((flag&0x0008)==0x0008);\r\n    out.flag.push((flag&0x0010)==0x0010);\r\n    out.flag.push((flag&0x0020)==0x0020);\r\n    out.flag.push((flag&0x0040)==0x0040);\r\n    out.flag.push((flag&0x0080)==0x0080);\r\n    out.flag.push((flag&0x0100)==0x0100);\r\n    out.flag.push((flag&0x0200)==0x0200);\r\n    out.flag.push((flag&0x0400)==0x0400);\r\n    out.flag.push((flag&0x0800)==0x0800);\r\n    out.flag.push((flag&0x1000)==0x1000);\r\n    out.flag.push((flag&0x1000)==0x2000);\r\n    out.flag.push((flag&0x1000)==0x4000);\r\n    out.flag.push((flag&0x1000)==0x8000);\r\n}\r\nfunction parseVoltageData(out,data){\r\n    out.min_voltage = (data[2] << 8) | data[3];\r\n    out.max_voltage = (data[4] << 8) | data[5];\r\n    out.pack_voltage = (data[6] << 24) | (data[7] << 16) | (data[8] << 8) | data[9];\r\n}\r\nfunction parseTemperature(out,data){\r\n    out.temp_array = [];\r\n    for(var i=2; i<data.length-2;i++){\r\n        out.temp_array.push(data[i]);\r\n    }\r\n    out.highest = data[8];\r\n    out.pack_max_temp = data[9];\r\n}\r\nfunction parseThrottle(out,data){\r\n    out.difference_check = data[2];\r\n    out.throttle = (data[3] & 0x7F) << 8 | data[4];\r\n    var flag = data[6] << 24 | data[7] << 16 | data[8] << 8 | data[9];\r\n    out.flag = [];\r\n    out.flag.push((flag&0x0000)==0x0000);\r\n    out.flag.push((flag&0x0001)==0x0001);\r\n    out.flag.push((flag&0x0002)==0x0002);\r\n    out.flag.push((flag&0x0004)==0x0004);\r\n    out.flag.push((flag&0x0008)==0x0008);\r\n    out.flag.push((flag&0x0010)==0x0010);\r\n    out.flag.push((flag&0x0020)==0x0020);\r\n    out.flag.push((flag&0x0040)==0x0040);\r\n}\r\nfunction parseBrake(out,data){\r\n    out.difference_check = data[2];\r\n    out.brake = (data[3] & 0x7F) << 8 | data[4];\r\n    var flag = data[6] << 24 | data[7] << 16 | data[8] << 8 | data[9];\r\n    out.flag = [];\r\n    out.flag.push(flag&0x0000==0x0000);\r\n    out.flag.push(flag&0x0001==0x0001);\r\n    out.flag.push(flag&0x0002==0x0002);\r\n    out.flag.push(flag&0x0004==0x0004);\r\n    out.flag.push(flag&0x0008==0x0008);\r\n    out.flag.push(flag&0x0010==0x0010);\r\n    out.flag.push(flag&0x0020==0x0020);\r\n    out.flag.push(flag&0x0040==0x0040);\r\n}\r\nfunction chooseParser(out,data){\r\n      switch(data[0]){\r\n        case 1574:\r\n            parseDashStatus(out,data);\r\n            break;\r\n        case 513:\r\n            parseBrake(out,data);\r\n            break;\r\n        case 512:\r\n            parseThrottle(out,data);\r\n            break;\r\n        case 1160:\r\n            parseTemperature(out,data);\r\n            break;\r\n        case 392:\r\n            parsePackStatus(out,data);\r\n            break;\r\n        case 904:\r\n            parseVoltageData(out,data);\r\n            break;\r\n    }\r\n}\r\nclass parseStream extends stream.Transform{ //ES6 Javascript is now just Java, apparently\r\n    constructor(options) {\r\n        options = options || {};\r\n        options.objectMode = true;\r\n        super(options);\r\n    }\r\n    _transform(chunk, encoding, next) {\r\n        var transformed = this.parse(chunk);\r\n        this.push(transformed);\r\n        next();\r\n    }\r\n    parse(data){\r\n        if(data&&data.length>0){\r\n            var out = new Object();\r\n            var array = data;\r\n            out.CAN_Id = array[0];\r\n            out.Timestamp = array[1];\r\n            chooseParser(out,array);   \r\n            return out;\r\n        }\r\n        else return \"\";\r\n    }\r\n}\r\nmodule.exports = parseStream;"]}